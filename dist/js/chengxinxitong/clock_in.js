$(document).ready(function(){init_calendar(),change_month(),close_success_msg(),init_data(),$(".banner_title").on("tap",function(){go_clock_in()})});var go_clock_in=function(){post("http://s.chengxinxitong.com/app1.0.0/sendUserSign.action",{identify:get_identify_safe()},function(resp){var resp=eval("("+resp+")");return 0!=resp.errno&&"error"in resp?(alert(resp.error),!1):($(".income_box").text("激活 "+resp.money+" 个诚信币"),$(".msg_box").text(resp.message),void $(".success_clock_in_msg").show())})},close_success_msg=function(){$(".close_btn").on("tap",function(){$(".success_clock_in_msg").hide()})},change_month=function(){$(".change_btn").on("tap",function(){var e=$(this).parent(),t=e.children(".year"),n=e.children(".month"),r=new Date(parseInt(t.text()),parseInt(n.text())-1,1),a=parseInt($(this).attr("diff"));r.setMonth(r.getMonth()+a),update_calendar(r,0),t.text(r.getFullYear()),n.text(r.getMonth()+1)})},init_calendar=function(){update_calendar(new Date,0)},update_calendar=function(e,t){var n=new Date(e),r=new Date(e),a=r.getFullYear(),o=r.getMonth()+1;$(".month_box .year").text(a),$(".month_box .month").text(o);var s=r.getMonth();r.setDate(1);var i=r.getDay(),c=$(".calendar td");c.children(".day_circle").text(""),c.children(".today").removeClass("today"),c.children(".continuous").removeClass("continuous"),c.removeAttr("year").removeAttr("month").removeAttr("day");for(var d=0;31>d&&(r.setDate(d+1),r.getMonth()==s);d++)$(c[i+d]).attr("year",a).attr("month",o).attr("day",d+1),$(c[i+d]).parent().show(),$(c[i+d]).children(".day_circle").text(d+1),r.getDate()==n.getDate()?$(c[i+d]).children(".day_circle").addClass("today"):n.getDate()-r.getDate()<=t&&n.getDate()-r.getDate()>0&&$(c[i+d]).children(".day_circle").addClass("continuous");update_clock_in_days(e.getFullYear(),e.getMonth()+1)},update_clock_in_days=function(year,month){post("http://s.chengxinxitong.com/app1.0.0/getSignRecordListData.action",{identify:get_identify_safe(),year:year,month:month},function(resp){var resp=eval("("+resp+")");if(0!=resp.errno&&"error"in resp)return alert(resp.error),!1;for(var i in resp.list){var sign_in_day=resp.list[i]/1;$('.calendar td[year="'+year+'"][month="'+month+'"][day="'+sign_in_day+'"]').children(".day_circle").addClass("continuous")}})},init_data=function(){post("http://s.chengxinxitong.com/app1.0.0/getUserInfoData.action",{identify:get_identify_safe()},function(resp){var resp=eval("("+resp+")");return 0!=resp.errno&&"error"in resp?(alert(resp.error),!1):(0!=resp.sign_state&&($(".banner_title").text("已签到"),$(".banner_title").css("border","0.25rem solid #999"),$(".banner_title").css("color","#999"),$(".banner_title").addClass("disabled")),$(".today_clock_in_num").text("今日签到人数："+resp.sign_nums),$(".has_clock_in_num .num").text(resp.sign_days),void $(".contine_clock_in_num .num").text(resp.sign_goon))})};